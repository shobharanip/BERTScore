import pandas as pd
from Translation_evaluator import TranslationEvaluator

# 1. Read every sheet into a dict of DataFrames
input_path = "/appdata/cortex/dev1/shob/your_input.xlsx"
all_sheets = pd.read_excel(input_path, sheet_name=None)

# 2. Pick out the sheet(s) that actually have your translations
#    (e.g. assume itâ€™s called "translations")
translations_df = all_sheets["translations"]

# 3. Run your evaluator on that DataFrame
evaluator = TranslationEvaluator()
evaluator._data = translations_df  # bypass load_data if it only handles one sheet
evaluator.evaluate(
    prediction_cols=['base_madlad400_translation','base_helsinki_translation'],
    reference_col   ='en',
    metrics         =["BLEU","ChrF","ChrF++"],
    # omit keep_cols or use None so it pulls *all* columns from this sheet
)

# 4. Write **all** original sheets + your two new sheets to a fresh file
output_path = "/appdata/cortex/dev1/shob/translation_results_with_latencies.xlsx"
with pd.ExcelWriter(output_path, engine="openpyxl") as writer:
    # 4a) copy every original sheet
    for sheet_name, df in all_sheets.items():
        df.to_excel(writer, sheet_name=sheet_name, index=False)

    # 4b) dump your evaluation outputs
    evaluator._detailed_results.to_excel(writer,
                                         sheet_name="Detailed Results",
                                         index=False)
    evaluator._model_metrics.to_excel(writer,
                                      sheet_name="Model Metrics",
                                      index=False)

print(f"All sheets + evaluation written to {output_path}")