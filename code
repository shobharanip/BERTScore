import time
import pandas as pd

# 1. Copy your input DataFrame (must have columns "es" and "en")
df = testdf.copy()

# 2. Generate each model’s translation once
df['base_madlad400_translation'] = df['es'].apply(base_madlad_translate)
df['base_helsinki_translation'] = df['es'].apply(base_helsinki_translate)

# 3. Time each model for 10 runs
models = {
    'madlad400': base_madlad_translate,
    'helsinki':  base_helsinki_translate
}

for model_name, fn in models.items():
    for run in range(1, 11):
        times = []
        for text in df['es']:
            t0 = time.time()
            _ = fn(text)
            times.append(time.time() - t0)
        df[f'{model_name}_run{run}_time'] = times

# 4. Build the “average” sheet:
#    – rows = run1…run10 + “average”
#    – cols = madlad400, helsinki
runs = range(1, 11)
avg_df = pd.DataFrame(
    { model: [ df[f'{model}_run{r}_time'].mean() for r in runs ]
      for model in models },
    index=[f'run{r}' for r in runs]
)
avg_df.loc['average'] = avg_df.mean()

# 5. Write out to Excel
with pd.ExcelWriter('response_times_10runs.xlsx', engine='openpyxl') as writer:
    # Sheet 1: per‑sentence inputs, translations, and all 10 run times
    df.to_excel(
        writer,
        sheet_name='Per_Sentence_Times',
        columns=[
            'es', 'en',
            'base_madlad400_translation',
            'base_helsinki_translation'
        ] +
        [f'{model}_run{r}_time' for model in models for r in runs],
        index=True,
        index_label='Index'
    )

    # Sheet 2: average time per run and overall average
    avg_df.to_excel(
        writer,
        sheet_name='Average_Times',
        index=True,
        index_label='run'
    )