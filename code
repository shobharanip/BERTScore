import time
import pandas as pd

# 1. Copy your input DataFrame (must have columns "es" and "en")
df = testdf.copy()

# 2. Generate each model’s translation once
df['base_madlad400_translation'] = df['es'].apply(base_madlad_translate)
df['base_helsinki_translation'] = df['es'].apply(base_helsinki_translate)

# 3. Time each model for 10 runs
models = {
    'madlad400': base_madlad_translate,
    'helsinki':  base_helsinki_translate
}

for model_name, fn in models.items():
    for run in range(1, 11):
        times = []
        for text in df['es']:
            t0 = time.time()
            _ = fn(text)
            times.append(time.time() - t0)
        df[f'{model_name}_run{run}_time'] = times

# 4. Append a summary “average” row at the bottom of Sheet 1
#    Leave text & translation columns blank, fill only timing columns
avg_row = {col: '' for col in df.columns}
for model_name in models:
    for run in range(1, 11):
        col = f'{model_name}_run{run}_time'
        avg_row[col] = df[col].mean()
df.loc['average'] = avg_row

# 5. Build the average‐per‐run table for Sheet 2
runs = [f'run{r}' for r in range(1, 11)]
avg_df = pd.DataFrame({
    'run':       runs,
    'madlad400': [df[f'madlad400_run{r}_time'].mean() for r in range(1, 11)],
    'helsinki':  [df[f'helsinki_run{r}_time'].mean()  for r in range(1, 11)]
})

# 6. Write out to Excel with two sheets
with pd.ExcelWriter('response_times_10runs_with_average.xlsx', engine='openpyxl') as writer:
    # Sheet 1: per‑sentence + all 10 run times + bottom “average” row
    df.to_excel(
        writer,
        sheet_name='Per_Sentence_Times',
        index=True,
        index_label='Index'
    )
    # Sheet 2: average time per run
    avg_df.to_excel(
        writer,
        sheet_name='Average_Times',
        index=False
    )