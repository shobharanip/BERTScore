import time
import pandas as pd

# 1. Copy your input DataFrame (must have columns "es" and "en")
df = testdf.copy()

# 2. Generate each model’s translation once
df['base_madlad400_translation'] = df['es'].apply(base_madlad_translate)
df['base_helsinki_translation'] = df['es'].apply(base_helsinki_translate)

# 3. Time each model for 10 runs
models = {
    'madlad400': base_madlad_translate,
    'helsinki':  base_helsinki_translate
}

for model_name, fn in models.items():
    for run in range(1, 11):
        times = []
        for text in df['es']:
            t0 = time.time()
            _ = fn(text)
            times.append(time.time() - t0)
        df[f'{model_name}_run{run}_time'] = times

# 4. Append a summary “average” row at the bottom of the translations sheet
#    Leave text & translation columns blank, fill only timing columns
avg_row = {col: '' for col in df.columns}
for model_name in models:
    for run in range(1, 11):
        col = f'{model_name}_run{run}_time'
        avg_row[col] = df[col].mean()
df.loc['average'] = avg_row

# 5. Build the per‑run latency table, then append overall average row
runs = [f'run{r}' for r in range(1, 11)]
avg_df = pd.DataFrame({
    'run':       runs,
    'madlad400': [df[f'madlad400_{r}_time'].mean() for r in runs],
    'helsinki':  [df[f'helsinki_{r}_time'].mean()  for r in runs]
})
# overall average
avg_df.loc[len(avg_df)] = [
    'average',
    avg_df['madlad400'].mean(),
    avg_df['helsinki'].mean()
]

# 6. Write out to Excel with renamed sheets
with pd.ExcelWriter('response_times_10runs.xlsx', engine='openpyxl') as writer:
    # Sheet 1: per‑sentence translations + all 10 run times + bottom “average” row
    df.to_excel(
        writer,
        sheet_name='translations',
        index=True,
        index_label='Index'
    )
    # Sheet 2: per‑run latencies + “average” row
    avg_df.to_excel(
        writer,
        sheet_name='latency',
        index=False
    )